# Image data extracted from Oniiz_image_v2.md
# This file contains all product images and metadata for the chatbot

IMAGE_DATA = {
    "Bọt vệ sinh Oniiz": {
        "HDSD": {
            "url": "https://goxfkfz6v6.ufs.sh/f/MqdJQVTIGDYB10VKZUeodzDAUuLaXTc3lNqmw62rI5WVQ7iR",
            "description": "Hình ảnh hướng dẫn sử dụng của Bọt vệ sinh Oniiz",
            "tags": ["hướng dẫn sử dụng", "HSDS", "dùng như thế nào", "cách dùng"]
        },
        "hương": {
            "url": "https://goxfkfz6v6.ufs.sh/f/MqdJQVTIGDYBJZ9LqpOX2qjM8sbZgUmcE7PCQaioNRtOHvYe",
            "description": "Hình ảnh 3 mùi hương của Bọt vệ sinh Oniiz",
            "tags": ["có những hương gì?", "Có bao nhiêu hương?", "Có mấy loại?", "Có mấy mùi"]
        },
        "thành phần": {
            "url": "https://goxfkfz6v6.ufs.sh/f/MqdJQVTIGDYB7nfQw5ArgOk9acvUCPtXF8n7zQAKHNLZedWi",
            "description": "Hình ảnh thành phần của Bọt vệ sinh Oniiz",
            "tags": ["Thành phần"]
        },
        "an toàn": {
            "url": "https://goxfkfz6v6.ufs.sh/f/MqdJQVTIGDYB4hs6ogyf96Zq12LWbMNDszduxvpa0CBVehk3",
            "description": "Hình ảnh độ an toàn của Bọt vệ sinh Oniiz",
            "tags": ["Kiểm định gì chưa", "kiểm định", "an toàn", "pH"]
        },
        "hàng giả": [
            {
                "url": "https://goxfkfz6v6.ufs.sh/f/MqdJQVTIGDYBNyFkZbPnL7CG1Ed2xOANXg6HqaJucoQzF3Ur",
                "description": "Hình ảnh phân biệt hàng giả của Bọt vệ sinh Oniiz",
                "tags": ["Hàng giả", "phân biệt thật giả"]
            },
            {
                "url": "https://goxfkfz6v6.ufs.sh/f/MqdJQVTIGDYBXPBwNhgVMb39UNpgAlsuQKwrY1VZkyCdRL7j",
                "description": "Hình ảnh phân biệt hàng giả của Bọt vệ sinh Oniiz",
                "tags": ["Hàng giả", "phân biệt thật giả"]
            },
            {
                "url": "https://goxfkfz6v6.ufs.sh/f/MqdJQVTIGDYBv1pg2UWOl98xiZzedy5WVF2R7N3QtEPh1Ukc",
                "description": "Hình ảnh phân biệt hàng giả của Bọt vệ sinh Oniiz",
                "tags": ["Hàng giả", "phân biệt thật giả"]
            }
        ],
        "feedback": [
            {
                "url": "https://goxfkfz6v6.ufs.sh/f/MqdJQVTIGDYB0dKzQnpaliGMJh2US6xHPeFC1pWcwbDV0yRY",
                "description": "Hình ảnh feedback của Bọt vệ sinh Oniiz",
                "tags": ["Feedback", "đánh giá"]
            },
            {
                "url": "https://goxfkfz6v6.ufs.sh/f/MqdJQVTIGDYBxWzUGgIhLTUeOjyo56K1vN47nz8CY2uEVhiD",
                "description": "Hình ảnh feedback của Bọt vệ sinh Oniiz",
                "tags": ["Feedback", "đánh giá"]
            },
            {
                "url": "https://goxfkfz6v6.ufs.sh/f/MqdJQVTIGDYB9snL92SD3Fwfxbe1KL5l0POSzapcXIToUMvs",
                "description": "Hình ảnh feedback của Bọt vệ sinh Oniiz",
                "tags": ["Feedback", "đánh giá"]
            },
            {
                "url": "https://goxfkfz6v6.ufs.sh/f/MqdJQVTIGDYBqySGJU8mu45lKbCrWacxtPGe263gfjHYLM80",
                "description": "Hình ảnh feedback của Bọt vệ sinh Oniiz",
                "tags": ["Feedback", "đánh giá"]
            },
            {
                "url": "https://goxfkfz6v6.ufs.sh/f/MqdJQVTIGDYBsUzfI07nKifX78Zp2bRgdABP3aQE4mjL6TuH",
                "description": "Hình ảnh feedback của Bọt vệ sinh Oniiz",
                "tags": ["Feedback", "đánh giá"]
            },
            {
                "url": "https://goxfkfz6v6.ufs.sh/f/MqdJQVTIGDYBIMXX9z4pOfyr8He9slFazdWZmuGvbxKUJPYL",
                "description": "Hình ảnh feedback của Bọt vệ sinh Oniiz",
                "tags": ["Feedback", "đánh giá"]
            }
        ]
    },
    "Sữa tắm": {
        "hương": {
            "tổng quan": {
                "url": "https://goxfkfz6v6.ufs.sh/f/MqdJQVTIGDYBBjQ8ZoYtlyu4XRDEbLN13onimOe7zZfdvPwx",
                "description": "Hình ảnh 2 loại hương của sữa tắm Bel Homme và Men In Black",
                "tags": ["có những hương gì?", "Có bao nhiêu hương?", "Có mấy loại?", "Có mấy mùi"]
            },
            "Men In Black": {
                "url": "https://goxfkfz6v6.ufs.sh/f/MqdJQVTIGDYBPz0W5yTU0tYM6uNDmBqwRp1hbSlOaKWnj52e",
                "description": "Hình ảnh note hương của sữa tắm Men In Black",
                "tags": ["men in black"]
            },
            "Bel Homme": {
                "url": "https://goxfkfz6v6.ufs.sh/f/MqdJQVTIGDYB2Gvlrwzpou4SvPjU3yxrMRcBzEskleFNVqTf",
                "description": "Hình ảnh note hương của sữa tắm Bel Homme",
                "tags": ["Bel Homme"]
            }
        },
        "thành phần": {
            "url": "https://goxfkfz6v6.ufs.sh/f/MqdJQVTIGDYBUFVJg82uP3gT618iKQGZtb2y5qaYJ9SEl0rB",
            "description": "Hình ảnh thành phần chung của cả 2 loại sữa tắm",
            "tags": ["Thành phần"]
        },
        "HDSD": {
            "url": "https://goxfkfz6v6.ufs.sh/f/MqdJQVTIGDYBcHfS2g7nJs9MopOUPzS7wWgQ1L4RiZT5hmcY",
            "description": "Hình ảnh hướng dẫn sử dụng của Sữa tắm",
            "tags": ["hướng dẫn sử dụng", "HSDS", "dùng như thế nào", "cách dùng"]
        }
    },
    "Nước hoa": {
        "hương": {
            "url": "https://goxfkfz6v6.ufs.sh/f/MqdJQVTIGDYBtqOPog9h8HD3VcjNPsFUMqkeao2Ayg71d0Qi",
            "description": "Hình ảnh của 2 loại nước Nước hoa Paris và Miami",
            "tags": ["có những hương gì", "Có bao nhiêu hương", "Có mấy loại", "Có mấy mùi", "Mùi gì"]
        },
        "thành phần": {
            "url": "https://goxfkfz6v6.ufs.sh/f/MqdJQVTIGDYBXP8C1rRVMb39UNpgAlsuQKwrY1VZkyCdRL7j",
            "description": "Hình ảnh thành phần của Nước hoa",
            "tags": ["Thành phần"]
        },
        "paris": {
            "url": "https://goxfkfz6v6.ufs.sh/f/MqdJQVTIGDYBXjyYdzVMb39UNpgAlsuQKwrY1VZkyCdRL7jn",
            "description": "Hình ảnh giới thiệu về Nước hoa Paris",
            "tags": ["Paris"]
        },
        "miami": {
            "url": "https://goxfkfz6v6.ufs.sh/f/MqdJQVTIGDYBrXpAqjcSDGtb8o40FPWHcg3NYi9fznaOlQLZ",
            "description": "Hình ảnh giới thiệu về Nước hoa Miami",
            "tags": ["Miami"]
        }
    },
    "Xịt thơm miệng": {
        "hương": {
            "url": "https://goxfkfz6v6.ufs.sh/f/MqdJQVTIGDYBJSkubdOX2qjM8sbZgUmcE7PCQaioNRtOHvYe",
            "description": "Hình ảnh của 3 hương (3 loại) Xịt thơm miệng",
            "tags": ["có những hương gì?", "Có bao nhiêu hương?", "Có mấy loại?", "Có mấy mùi"]
        },
        "HDSD": {
            "url": "https://goxfkfz6v6.ufs.sh/f/MqdJQVTIGDYB1dFJIB3eodzDAUuLaXTc3lNqmw62rI5WVQ7i",
            "description": "Hình ảnh hướng dẫn sử dụng của Xịt thơm miệng",
            "tags": ["hướng dẫn sử dụng", "HSDS", "dùng như thế nào", "cách dùng"]
        },
        "công dụng": [
            {
                "url": "https://goxfkfz6v6.ufs.sh/f/MqdJQVTIGDYBUqf36E2uP3gT618iKQGZtb2y5qaYJ9SEl0rB",
                "description": "Hình ảnh công dụng của xịt thơm miệng",
                "tags": ["công dụng", "tác dụng"]
            },
            {
                "url": "https://goxfkfz6v6.ufs.sh/f/MqdJQVTIGDYBeReZY13B5gUORq3TMP6aKYpmjXJcfnw0Hu2L",
                "description": "Hình ảnh công dụng của xịt thơm miệng",
                "tags": ["công dụng", "tác dụng"]
            }
        ]
    },
    "Bao cao su": {
        "hương": [
            {
                "url": "https://goxfkfz6v6.ufs.sh/f/MqdJQVTIGDYBePrF5h3B5gUORq3TMP6aKYpmjXJcfnw0Hu2L",
                "description": "Hình ảnh 4 hương của bao cao su v2joy",
                "tags": ["có những hương gì?", "Có bao nhiêu hương?", "Có mấy loại?", "Có mấy mùi"]
            },
            {
                "url": "https://goxfkfz6v6.ufs.sh/f/MqdJQVTIGDYBIb6wVf4pOfyr8He9slFazdWZmuGvbxKUJPYL",
                "description": "Hình ảnh 4 hương của bao cao su v2joy",
                "tags": ["có những hương gì?", "Có bao nhiêu hương?", "Có mấy loại?", "Có mấy mùi"]
            }
        ],
        "thành phần": {
            "url": "https://goxfkfz6v6.ufs.sh/f/MqdJQVTIGDYBrFZlQFqcSDGtb8o40FPWHcg3NYi9fznaOlQL",
            "description": "Hình ảnh thành phẩn và số lượng trong mỗi hộp Bao cao su",
            "tags": ["Hộp mấy chiếc", "số lượng", "thành phần"]
        }
    }
}

# Helper functions to get images
def get_product_image(product_name, topic=None, index=0):
    """Get image URL for a specific product and topic"""
    if product_name not in IMAGE_DATA:
        return None
    
    product_data = IMAGE_DATA[product_name]
    
    if topic is None:
        # Return first available image
        for key, value in product_data.items():
            if isinstance(value, dict) and 'url' in value:
                return value['url']
            elif isinstance(value, list) and len(value) > 0:
                return value[0]['url']
        return None
    
    if topic not in product_data:
        return None
    
    topic_data = product_data[topic]
    
    if isinstance(topic_data, dict):
        if 'url' in topic_data:
            return topic_data['url']
        else:
            # Handle nested structure like "hương" in "Sữa tắm"
            for key, value in topic_data.items():
                if isinstance(value, dict) and 'url' in value:
                    return value['url']
    elif isinstance(topic_data, list):
        if index < len(topic_data):
            return topic_data[index]['url']
    
    return None

def get_all_product_images(product_name):
    """Get all images for a product"""
    if product_name not in IMAGE_DATA:
        return []
    
    images = []
    product_data = IMAGE_DATA[product_name]
    
    for topic, data in product_data.items():
        if isinstance(data, dict) and 'url' in data:
            images.append({
                'topic': topic,
                'url': data['url'],
                'description': data.get('description', ''),
                'tags': data.get('tags', [])
            })
        elif isinstance(data, list):
            for i, item in enumerate(data):
                if isinstance(item, dict) and 'url' in item:
                    images.append({
                        'topic': f"{topic}_{i+1}",
                        'url': item['url'],
                        'description': item.get('description', ''),
                        'tags': item.get('tags', [])
                    })
        elif isinstance(data, dict):
            # Handle nested structure
            for sub_topic, sub_data in data.items():
                if isinstance(sub_data, dict) and 'url' in sub_data:
                    images.append({
                        'topic': f"{topic}_{sub_topic}",
                        'url': sub_data['url'],
                        'description': sub_data.get('description', ''),
                        'tags': sub_data.get('tags', [])
                    })
    
    return images

def search_images_by_tags(search_terms):
    """Search images by tags or keywords"""
    results = []
    search_terms_lower = [term.lower() for term in search_terms]
    
    for product_name, product_data in IMAGE_DATA.items():
        for topic, data in product_data.items():
            items_to_check = []
            
            if isinstance(data, dict) and 'url' in data:
                items_to_check = [data]
            elif isinstance(data, list):
                items_to_check = data
            elif isinstance(data, dict):
                # Handle nested structure
                for sub_data in data.values():
                    if isinstance(sub_data, dict) and 'url' in sub_data:
                        items_to_check.append(sub_data)
            
            for item in items_to_check:
                if isinstance(item, dict) and 'tags' in item:
                    tags_lower = [tag.lower() for tag in item['tags']]
                    description_lower = item.get('description', '').lower()
                    
                    # Check if any search term matches tags or description
                    for search_term in search_terms_lower:
                        if (any(search_term in tag for tag in tags_lower) or 
                            search_term in description_lower or
                            search_term in product_name.lower() or
                            search_term in topic.lower()):
                            
                            results.append({
                                'product': product_name,
                                'topic': topic,
                                'url': item['url'],
                                'description': item.get('description', ''),
                                'tags': item.get('tags', [])
                            })
                            break
    
    return results